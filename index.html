<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>German Special Forces</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      color: #333;
      overflow-x: hidden;
      background-image: url('https://image.shutterstock.com/image-vector/deutsch-interpreter-language-online-german-260nw-2204068283.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      position: relative;
    }

    /* Overlay */
    body::before {
      content: "";
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255,255,255,0.85);
      z-index: 0;
      pointer-events: none;
    }

    /* App container */
    #app {
      max-width: 900px;
      margin: 50px auto;
      background: rgba(255, 255, 255, 0.95);
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      position: relative;
      z-index: 1;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }
    header h1 {
      font-family: 'Montserrat', sans-serif;
      color: #2C3E50;
      margin: 0;
    }
    header p {
      color: #34495E;
      margin: 5px 0 0;
    }

    /* Login screen */
    #login-screen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    #login-screen input {
      padding: 10px 15px;
      margin: 10px;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 16px;
      width: 200px;
    }
    #login-screen button {
      padding: 12px 25px;
      margin: 10px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    #login-screen button:hover {
      background: #2980b9;
    }

    /* Stats & progress */
    #stats {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
      font-weight: bold;
      color: #2C3E50;
    }
    .progress-container {
      width: 100%;
      background: #bdc3c7;
      border-radius: 20px;
      height: 25px;
      margin-bottom: 20px;
      overflow: hidden;
    }
    .progress-bar {
      width: 0%;
      height: 100%;
      background: linear-gradient(90deg, #f1c40f, #e67e22);
      border-radius: 20px;
      transition: width 0.4s;
    }

    /* Weeks */
    #weeks {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 25px;
      justify-content: center;
    }
    .week-card {
      flex: 1 1 120px;
      background: #3498db;
      color: white;
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      cursor: pointer;
      transition: transform 0.2s, background 0.3s;
      font-weight: bold;
      user-select: none;
    }
    .week-card:hover {
      transform: scale(1.05);
      background: #2980b9;
    }

    /* Exercise card */
    #exercise {
      background: #ecf0f1;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 20px;
      min-height: 200px;
    }

    /* Buttons */
    button.answer-btn, button#submit-btn {
      background: #2ecc71;
      border: none;
      color: white;
      padding: 12px 25px;
      margin: 10px 5px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: 0.2s;
    }
    button.answer-btn:hover, button#submit-btn:hover {
      background: #27ae60;
    }

    /* Audio */
    audio {
      width: 100%;
      margin-top: 10px;
      border-radius: 8px;
      outline: none;
    }

    @media (max-width: 600px) {
      #weeks { flex-direction: column; align-items: center; }
      .week-card { width: 80%; }
    }
  </style>

  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCWAkeJhwzxwdKsbCKavOu9C-pZIZENftI",
      authDomain: "german-special-forces.firebaseapp.com",
      projectId: "german-special-forces",
      storageBucket: "german-special-forces.appspot.com",
      messagingSenderId: "440759850329",
      appId: "1:440759850329:web:33a1f0116e1c32f2132848"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ---- UI ELEMENTS ----
    const appDiv = document.getElementById('app');

    const loginScreen = document.createElement('div');
    loginScreen.id = "login-screen";
    loginScreen.innerHTML = `
      <h2>Login / Register</h2>
      <input type="text" id="username" placeholder="Enter username" />
      <button id="login-btn">Start Mission</button>
    `;
    appDiv.prepend(loginScreen);

    const usernameInput = loginScreen.querySelector('#username');
    const loginBtn = loginScreen.querySelector('#login-btn');

    let currentUser = null;
    let userData = { xp:0, streak:0, week:1, exerciseIndex:0 };

    // ---- Week 1 Exercises (50 sample MCQs, can expand) ----
    const week1Exercises = [
      { question: "Hallo means?", choices:["Hello","Goodbye","Thanks"], answer: "Hello" },
      { question: "Danke means?", choices:["Hello","Thank you","Sorry"], answer: "Thank you" },
      { question: "TschÃ¼ss means?", choices:["Hi","Goodbye","Please"], answer: "Goodbye" },
      // ... add 47 more exercises here
    ];
    while(week1Exercises.length<50){
      week1Exercises.push({ question:"Dummy question", choices:["A","B","C"], answer:"A" });
    }

    const weeksContainer = document.createElement('div');
    weeksContainer.id = 'weeks';
    appDiv.appendChild(weeksContainer);

    const exerciseDiv = document.getElementById('exercise');
    const submitBtn = document.getElementById('submit-btn');
    const xpSpan = document.getElementById('xp');
    const streakSpan = document.getElementById('streak');
    const progressBar = document.getElementById('progress-bar');
    const audioPlayer = document.getElementById('audio-player');

    // ---- LOGIN HANDLER ----
    loginBtn.addEventListener('click', async ()=>{
      const username = usernameInput.value.trim().toLowerCase();
      if(!username){ alert("Enter username"); return; }
      currentUser = username;

      const docRef = doc(db, "users", currentUser);
      const docSnap = await getDoc(docRef);
      if(docSnap.exists()){
        userData = docSnap.data();
      } else {
        await setDoc(docRef, userData);
      }

      loginScreen.style.display = "none";
      renderWeeks();
      loadWeek(userData.week);
    });

    // ---- RENDER WEEKS ----
    function renderWeeks(){
      weeksContainer.innerHTML = "";
      for(let i=1;i<=1;i++){ // only week 1 for now
        const card = document.createElement('div');
        card.className = 'week-card';
        card.textContent = `Week ${i}`;
        card.addEventListener('click', ()=>{ loadWeek(i); });
        weeksContainer.appendChild(card);
      }
    }

    let currentWeek = 1;
    let currentExerciseIndex = 0;

    function loadWeek(week){
      currentWeek = week;
      if(week===1){
        renderExercise(week1Exercises[currentExerciseIndex]);
      }
      // placeholder audio
      audioPlayer.src = "https://www.example.com/placeholder.mp3";
    }

    function renderExercise(ex){
      exerciseDiv.innerHTML = `<h3>${ex.question}</h3>`;
      ex.choices.forEach(c=>{
        const btn = document.createElement('button');
        btn.textContent = c;
        btn.className = "answer-btn";
        btn.onclick = ()=>{ handleAnswer(c, ex.answer); };
        exerciseDiv.appendChild(btn);
      });
      updateProgress();
    }

    function handleAnswer(choice, correct){
      if(choice===correct){
        alert("âœ… Correct +10 XP");
        userData.xp += 10;
        userData.streak += 1;
      } else {
        alert("âŒ Wrong, try again!");
        userData.streak = 0;
      }
      currentExerciseIndex++;
      if(currentExerciseIndex>=week1Exercises.length){
        alert("ðŸŽ‰ Week Complete!");
        userData.week++;
        currentExerciseIndex=0;
      }
      userData.exerciseIndex = currentExerciseIndex;
      saveUserData();
      if(userData.week===1) renderExercise(week1Exercises[currentExerciseIndex]);
    }

    async function saveUserData(){
      const docRef = doc(db, "users", currentUser);
      await setDoc(docRef, userData);
      xpSpan.textContent = `XP: ${userData.xp}`;
      streakSpan.textContent = `Streak: ${userData.streak}`;
      updateProgress();
    }

    function updateProgress(){
      const progress = (currentExerciseIndex / week1Exercises.length)*100;
      progressBar.style.width = `${progress}%`;
    }
  </script>
</head>
<body>
  <div id="app"></div>
</body>
</html>
