<!DOCTYPE html>
<html>
<head>
  <title>German Special Forces Academy</title>
  <style>
    body {
      font-family: Arial;
      background: #111;
      color: white;
      padding: 30px;
    }
    h1 { color: #4CAF50; }
    button {
      padding: 8px 15px;
      margin: 5px 5px 5px 0;
      background: #4CAF50;
      border: none;
      color: white;
      cursor: pointer;
    }
    .section {
      margin-top: 20px;
      padding: 20px;
      background: #222;
      border-radius: 8px;
    }
    textarea {
      width: 100%;
      margin-top: 10px;
      padding: 8px;
      background: #333;
      color: white;
      border: none;
    }
    .hidden { display: none; }
  </style>
</head>
<body>

<h1>ðŸ‡©ðŸ‡ª German Special Forces Academy</h1>

<div id="login" class="section">
  <h2>Select User</h2>
  <button onclick="login('Asaf')">Asaf</button>
  <button onclick="login('Brother1')">Brother 1</button>
  <button onclick="login('Brother2')">Brother 2</button>
</div>

<div id="dashboard" class="hidden">

  <div class="section">
    <h2 id="welcome"></h2>
    <button onclick="logout()">Switch User</button>
  </div>

  <div class="section">
    <h2>Current Phase</h2>
    <p id="phase">Phase 1 â€“ A1 Foundation</p>
  </div>

  <div class="section">
    <h2>XP & Progress</h2>
    <p>XP: <span id="xp">0</span></p>
    <p>Homework Streak: <span id="streak">0</span></p>
    <button onclick="addXP(10)">+10 XP (Complete Exercise)</button>
    <button onclick="addXP(25)">+25 XP (Finish Lesson)</button>
  </div>

  <div class="section">
    <h2>This Week's Lesson</h2>
    <p>Week 1: Present tense + sentence structure.</p>
  </div>

  <div class="section">
    <h2>Homework</h2>
    <textarea id="homework" rows="6"></textarea>
    <button onclick="saveHomework()">Submit Homework (+20 XP)</button>
  </div>

  <div class="section">
    <h2>Leaderboard</h2>
    <div id="leaderboard"></div>
  </div>

</div>

<!-- Firebase SDKs -->
<script type="module">
  // Import Firebase functions
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCWAkeJhwzxwdKsbCKavOu9C-pZIZENftI",
    authDomain: "german-special-forces.firebaseapp.com",
    projectId: "german-special-forces",
    storageBucket: "german-special-forces.firebasestorage.app",
    messagingSenderId: "440759850329",
    appId: "1:440759850329:web:33a1f0116e1c32f2132848"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUser = null;
  let users = ["Asaf","Brother1","Brother2"];

  // LOGIN
  window.login = async function(name){
    currentUser = name;
    document.getElementById("login").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    document.getElementById("welcome").innerText = "Welcome, " + name;

    // Initialize user in Firestore if not exists
    const userRef = doc(db, "users", currentUser);
    const userSnap = await getDoc(userRef);
    if(!userSnap.exists()){
      await setDoc(userRef, {xp:0, streak:0, homework:""});
    }

    loadUser();
    updateLeaderboard();
  }

  // LOGOUT
  window.logout = function(){
    currentUser = null;
    document.getElementById("dashboard").classList.add("hidden");
    document.getElementById("login").classList.remove("hidden");
  }

  // LOAD USER DATA
  async function loadUser(){
    const userRef = doc(db, "users", currentUser);
    const userSnap = await getDoc(userRef);
    if(userSnap.exists()){
      const data = userSnap.data();
      document.getElementById("xp").innerText = data.xp || 0;
      document.getElementById("streak").innerText = data.streak || 0;
      document.getElementById("homework").value = data.homework || "";
    }
  }

  // SAVE HOMEWORK
  window.saveHomework = async function(){
    const homeworkText = document.getElementById("homework").value;
    const userRef = doc(db, "users", currentUser);

    // Get current data
    const userSnap = await getDoc(userRef);
    let data = userSnap.data();

    // Update streak & XP
    const newStreak = (data.streak || 0) + 1;
    const newXP = (data.xp || 0) + 20;

    await setDoc(userRef, {
      xp: newXP,
      streak: newStreak,
      homework: homeworkText
    });

    document.getElementById("xp").innerText = newXP;
    document.getElementById("streak").innerText = newStreak;

    updateLeaderboard();
  }

  // ADD XP MANUALLY
  window.addXP = async function(amount){
    const userRef = doc(db, "users", currentUser);
    const userSnap = await getDoc(userRef);
    let data = userSnap.data();
    const newXP = (data.xp || 0) + amount;

    await updateDoc(userRef, {xp: newXP});
    document.getElementById("xp").innerText = newXP;

    updateLeaderboard();
  }

  // UPDATE LEADERBOARD
  async function updateLeaderboard(){
    let ranking = [];
    for(let u of users){
      const userRef = doc(db, "users", u);
      const userSnap = await getDoc(userRef);
      let xp = 0;
      if(userSnap.exists()){
        xp = userSnap.data().xp || 0;
      }
      ranking.push({name:u, xp: xp});
    }

    ranking.sort((a,b)=>b.xp - a.xp);

    let html = "";
    ranking.forEach((u,i)=>{
      html += `<p>${i+1}. ${u.name} â€“ ${u.xp} XP</p>`;
    });

    document.getElementById("leaderboard").innerHTML = html;
  }

</script>

</body>
</html>
